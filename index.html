<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Ribs.js Intro</title>

    <style type="text/css">
        @import "jquery.svg.css";

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
        }

        #mySvg {
            margin: auto auto;
            height: 600px;
            width: 800px;
            border: 1px solid black;
            background: #ffffff;
        }

    </style>
	<script type="text/javascript" src="jquery-1.4.2.js"></script>
    <script type="text/javascript" src="jquery.svg.js"></script>
    <script type="text/javascript" src="jquery.svgdom.js"></script>
    <script type="text/javascript" src="jquery.svganim.js"></script>

	<script type="text/javascript">

        var onKeyDown;
        
        $(function () {
            var loadDone = function (svg, error) {
                    slides = [];
                    $("rect", svg.root()).each(function (index, value) {
                        var $value = $(value),
                            slideMatch = $value.attr("id").match(/^slide([0-9]*)/);
                        if (slideMatch) {
                            var slideIndex = parseInt(slideMatch[1]),
                                slide = {
                                    x: parseFloat($value.attr("x")), y: parseFloat($value.attr("y")),
                                    width: parseFloat($value.attr("width")), height: parseFloat($value.attr("height")),
                                    sideways: parseFloat($value.attr("height")) > parseFloat($value.attr("width"))
                                };
                            $value.remove();
                            slides[slideIndex-1] = slide;
                        }
                    });

                    for (var i = 1; i < slides.length; i++) {
                        if (slides[i - 1].sideways && slides[i].sideways) {
                            alert("Does not currently support sideways slides")
                        }
                    }

                    mainGroup = $("g:first", svg.root());
                    mainGroup.attr("transform", calculateSlideTransformation(slides[0]));
                },
                svg = $('#mySvg').svg({
                    loadURL: "ribs3.svg",
                    onLoad: loadDone,
                    settings: {addTo: true, changeSize: false}
                }),
                mainGroup, slides = [],
                currentSlideIndex = 0,
                calculateSlideTransformation = function (slide) {
                    var canvasWidth = parseFloat($("#mySvg").width()),
                        canvasHeight = parseFloat($("#mySvg").height()),

                        scaleX = (canvasWidth / (slide.sideways ? slide.height : slide.width)),
                        scaleY = (canvasHeight / (slide.sideways ? slide.width : slide.height)),
                        scaleString = "scale(" + scaleX + " " + scaleY + ")",

                        rotate = slide.sideways ? 90 : 0,
                        rotateString = "rotate(" + rotate + " 0 0)",

                        translateX = slide.sideways ? slide.y + canvasWidth/scaleX: -slide.x,
                        translateY = slide.sideways ? -slide.x : -slide.y,
                        translateString = "translate(" + translateX + " " + translateY + ")",

                        transformString = scaleString + " " + translateString + " " + rotateString;

                    return transformString;
                },
                animateWithTransformation = function () {
                    var transformationString = calculateSlideTransformation(slides[currentSlideIndex]);
                    mainGroup.animate({svgTransform: transformationString}, 1000);
                },
                showPrevSlide = function () {
                    if (currentSlideIndex > 0) {
                        currentSlideIndex = currentSlideIndex - 1;
                        animateWithTransformation();
                    }
                },
                showNextSlide = function () {
                    if (currentSlideIndex < slides.length) {
                        currentSlideIndex = currentSlideIndex + 1;
                        animateWithTransformation();
                    }
                };

                onKeyDown = function (event) {
                    if (event.keyCode === 39) {
                        showNextSlide();
                    } else if (event.keyCode === 37) {
                        showPrevSlide();
                    }
                };
        });

	</script>
</head>
<body onkeydown="onKeyDown(event)">

<div id="mySvg"></div>

</body>
</html>