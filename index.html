<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Ribs.js Intro</title>

    <style type="text/css">
        @import "jquery.svg.css";

        body {
            margin: 0;
            padding: 0;
        }
        
        #mySvg {
            width: 640px;
            height: 480px;
            border: 1px solid black;
        }

    </style>
	<script type="text/javascript" src="jquery-1.4.2.js"></script>
    <script type="text/javascript" src="jquery.svg.js"></script>
    <script type="text/javascript" src="jquery.svgdom.js"></script>
    <script type="text/javascript" src="jquery.svganim.js"></script>

	<script type="text/javascript">

        $(function () {
            var svg = $('#mySvg').svg({
                    loadURL: "ribs2.svg",
                    onLoad: loadDone,
                    settings: {addTo: true, changeSize: false}
                });

            // Callback after loading external document
            function loadDone(svg, error) {
                console.log(svg.root());

                slides = [];
                $("rect", svg.root()).each(function (index, value) {
                    var $value = $(value),
                        slideMatch = $value.attr("id").match(/^slide([0-9]*)/);
                    if (slideMatch) {
                        var slideIndex = parseInt(slideMatch[1]),
                            slide = {
                                x: parseFloat($value.attr("x")), y: parseFloat($value.attr("y")),
                                width: parseFloat($value.attr("width")), height: parseFloat($value.attr("height")),
                                sideways: parseFloat($value.attr("height")) > parseFloat($value.attr("width"))
                            };
                        $value.remove();
                        slides[slideIndex-1] = slide;
                    }
                });
                console.log(slides);

                mainGroup = $("g:first", svg.root());
                mainGroup.attr("transform", calculateSlideTransformation(slides[0]));
            }
        });

        var mainGroup, slides = [],
            currentSlideIndex = 0,
            calculateSlideTransformation = function (slide) {
                var currentTransformation = mainGroup.attr("transform"),
                    oldTranslate = currentTransformation.match(/translate\(([-\.0-9]*),([-\.0-9]*)\)/),
                    oldTranslateX = oldTranslate ? parseFloat(oldTranslate[1]) : 0,
                    oldTranslateY = oldTranslate ? parseFloat(oldTranslate[2]) : 0,
                    oldScale = currentTransformation.match(/scale\(([-\.0-9]*),([-\.0-9]*)\)/),
                    oldScaleX = oldScale ? parseFloat(oldScale[1]) : 1,
                    oldScaleY = oldScale ? parseFloat(oldScale[2]) : 1,

                    canvasWidth = parseFloat($("#mySvg").width()),
                    canvasHeight = parseFloat($("#mySvg").height()),

                    scaleX = (canvasWidth / (slide.sideways ? slide.height : slide.width)),
                    scaleY = (canvasHeight / (slide.sideways ? slide.width : slide.height)),
                    scaleString = "scale(" + scaleX + " " + scaleY + ")",

                    rotate = slide.sideways ? 90 : 0,
                    rotateString = "rotate(" + rotate + " 0 0)",

                    translateX = slide.sideways ? slide.y + canvasWidth/scaleX: -slide.x,
                    translateY = slide.sideways ? -slide.x : -slide.y,
                    translateString = "translate(" + translateX + " " + translateY + ")",

                    transformString = scaleString + " " + translateString + " " + rotateString;

                return transformString;
            },
            showNextSlide = function () {
                currentSlideIndex = (currentSlideIndex + 1) % slides.length;
                var transformationString = calculateSlideTransformation(slides[currentSlideIndex]);
                console.log(transformationString);
                mainGroup.animate({svgTransform: transformationString}, 1000);
            };

	</script>
</head>
<body onclick="showNextSlide()">

<div id="mySvg"></div>

</body>
</html>