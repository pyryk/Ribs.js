<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>ThighBone.js test</title>
    <style type="text/css">

        body {
            font-family: "Helvetica Neue", "Helvetica", "Arial";
            font-size: 9pt;
            margin: 0;
            padding: 0;
        }

        .folder-icon {
            display: inline-block;
            padding: 0 2px;
            width: 10px;
            font-size: 11pt;
            border: 1px solid #aaa;
            cursor: pointer;
            cursor: hand;
        }

        #fruit-details {
            position: fixed;
            right: 0;
            top: 0;
            bottom: 0;
            left: 38.2%;
            background: #000;
        }

        #fruit-list {
            width: 38.2%;
            padding-bottom: 3px;
            padding-left: 3px;
        }

        .item-body {
            display: inline-block;
        }

        .fruit-item {
            margin-left: 30px;
        }

        .item-body, .fruit-item {
            background: #eee;
            width: 200px;
            border: 1px solid #ddd;
            margin: 3px 3px 0 3px;
            padding: 3px 4px 1px 4px;
            cursor: pointer;
            cursor: hand;
            right: 0;
        }

        .item-body.selected, .fruit-item.selected {
            background: #444;
            border: 1px solid #000;
            color: #fff;
        }

        .item-body.hovering, .fruit-item.hovering {
            border: 1px solid #666;
        }

    </style>
    <script src="lib/LAB.js" type="text/javascript"></script>
    <script type="text/javascript">
        var fruitsCollection, alphabets = {}, alphabetsCollection,
            generateAlphabets = function () {
                alphabetsCollection = new Backbone.Collection();
                for (var i = 0; i < 26; i++) {
                    var alphabet = String.fromCharCode(65 + i),
                        alphabetModel = new Backbone.Model({
                            alphabet: alphabet,
                            fruits: new Backbone.Collection()
                        });
                    alphabets[alphabet] = alphabetModel;
                    alphabetsCollection.add(alphabetModel);
                }
            },
            generateFruits = function (data) {
                var fruitArray = data.split("\n");
                fruitsCollection = new Backbone.Collection();
                _.each(fruitArray, function (fruitName) {
                    var fruit = new Backbone.Model({
                        name: fruitName,
                        available: Math.random() < 0.7,
                        price: Math.floor(Math.random() * 20)
                    });
                    fruitsCollection.add(fruit);
                    if (alphabets.hasOwnProperty(fruitName.substr(0, 1))) {
                        alphabets[fruitName.substr(0, 1)].get("fruits").add(fruit);
                    }
                });

                initialize();
            },
            initialize = function () {
                var FruitItem = Thighbone.createMixed({
                       mixinClasses: [
                           Thighbone.mixins.Templated({
                               templateFunction: _.template($("#fruit-item-tmpl").html()),
                               tagClass: "fruit-item"
                           }),
                           Thighbone.mixins.Hoverable({}),
                           Thighbone.mixins.Selectable({})
                       ]
                    }),
                    FruitList = Thighbone.createMixed({
                        mixinClasses: [
                            Thighbone.mixins.SimpleList({
                                ItemRenderer: FruitItem
                            })
                        ]
                    }),
                    AlphabetItem = Thighbone.createMixed({
                        mixinClasses: [
                            Thighbone.mixins.Templated({
                                templateFunction: _.template($("#alphabet-item-tmpl").html()),
                                tagClass: "alphabet-item"
                            }),
                            Thighbone.mixins.ToggleableElement({ elementSelector: ".nested-fruit-list:first" }),
                            Thighbone.mixins.SimpleList({
                                elementSelector: ".nested-fruit-list:first",
                                ItemRenderer: FruitItem,
                                listAttributeName: "fruits"
                            }),
                            Thighbone.mixins.Hoverable({ elementSelector: ".item-body:first" }),
                            Thighbone.mixins.Selectable({ elementSelector: ".item-body:first" }),
                            Thighbone.mixins.Toggleable({ elementSelector: ".folder-icon:first", usePlusMinus: true })
                        ]
                    }),
                    AlphabetList = Thighbone.createMixed({
                        mixinClasses: [
                            Thighbone.mixins.SimpleList({
                                ItemRenderer: AlphabetItem
                            })
                        ]
                    });

                Thighbone.createUIManager("main", { allowMultiselect: false });
                Thighbone.uiManagers.main.register(fruitsCollection);
                Thighbone.uiManagers.main.register(alphabetsCollection);

                //new FruitList({ model: fruitsCollection, el: $("#fruit-list")});
                new AlphabetList({ model: alphabetsCollection, el: $("#fruit-list")});
            };

        $LAB
                .script("lib/jquery-1.5.min.js")
                .script("lib/underscore.js")
                .script("lib/backbone.js").wait()
                .script("js/thighbone/thighbone.js").wait()
                .script("js/thighbone/mixins/hoverable.js")
                .script("js/thighbone/mixins/nestedlist.js")
                .script("js/thighbone/mixins/selectable.js")
                .script("js/thighbone/mixins/simplelist.js")
                .script("js/thighbone/mixins/templated.js")
                .script("js/thighbone/mixins/toggleable.js")
                .script("js/thighbone/mixins/toggleableelement.js")
                .script("js/thighbone/utils/uimanager.js")
                .wait(function () {
                    $.ajax({ url: "json/fruits.json", dataType: "text" })
                            .success(function (data) {
                                generateAlphabets();
                                generateFruits(data);
                                initialize();
                            });
                });
    </script>
</head>
<body>

<div id="fruit-list"></div>
<div id="fruit-details"></div>

<script id="fruit-item-tmpl" type="text/html">
<%= name %> (<%= available ? "available" : "sold out"%>)
</script>

<script id="alphabet-item-tmpl" type="text/html">
<div><span class="folder-icon">+</span><div class="item-body"><b><%= alphabet %></b> (<%= fruits.length %> fruits)</div></div>
<div class="nested-fruit-list"></div>
</script>

</body>
</html>