<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>ThighBone.js test</title>
    <style type="text/css">

        body {
            font-family: "Helvetica Neue", "Helvetica", "Arial";
            font-size: 9pt;
            margin: 0;
            padding: 0;
        }

        h2 {
            margin: 6px 7px;
        }

        .folder-icon {
            display: inline-block;
            padding: 0;
            width: 10px;
            font-size: 11pt;
            cursor: pointer;
            cursor: hand;
        }

        #fruit-details {
            position: fixed;
            right: 0;
            top: 0;
            bottom: 0;
            left: 38.2%;
        }

        #fruit-list, #alphabet-list {
            display: inline-block;
            vertical-align: top;
            width: 19.1%;
            padding-bottom: 3px;
            padding-left: 3px;
        }

        .item-body, .fruit-item {
            background: #eee;
            width: 180px;
            border: 1px solid #ddd;
            margin: 3px 3px 0 3px;
            padding: 3px 4px 1px 4px;
            cursor: pointer;
            cursor: hand;
            right: 0;
        }

        .item-body {
            display: inline-block;
        }

        #alphabet-list .fruit-item {
            margin-left: 30px;
        }

        .item-body.selected, .fruit-item.selected {
            background: #444;
            border: 1px solid #000;
            color: #fff;
        }

        .item-body.hovering, .fruit-item.hovering {
            border: 1px solid #666;
        }

    </style>
    <script src="lib/jquery-1.5.min.js"></script>
    <script src="lib/underscore.js"></script>
    <script src="lib/backbone.js"></script>
    
    <script src="js/ribs/core.js"></script>
    <script src="js/ribs/managedview.js"></script>
    <script src="js/ribs/mixins/hoverable.js"></script>
    <script src="js/ribs/mixins/selectable.js"></script>
    <script src="js/ribs/mixins/simplelist.js"></script>
    <script src="js/ribs/mixins/templated.js"></script>
    <script src="js/ribs/mixins/toggleable.js"></script>
    <script src="js/ribs/mixins/toggleableelement.js"></script>
    <script src="js/ribs/utils/uimanager.js"></script>
    
    <script type="text/javascript">
        var fruitsCollection, alphabets = {}, alphabetsCollection,
            fruitDetailsView,
            generateAlphabets = function () {
                alphabetsCollection = new Backbone.Collection();
                for (var i = 0; i < 26; i++) {
                    var alphabet = String.fromCharCode(65 + i),
                        alphabetModel = new Backbone.Model({
                            alphabet: alphabet,
                            fruits: new Backbone.Collection()
                        });
                    alphabets[alphabet] = alphabetModel;
                    alphabetsCollection.add(alphabetModel);
                }
            },
            generateFruits = function (data) {
                var fruitArray = data.split("\n");
                fruitsCollection = new Backbone.Collection();
                _.each(fruitArray, function (fruitName) {
                    var fruit = new Backbone.Model({
                        name: fruitName,
                        available: Math.random() < 0.7,
                        price: Math.floor(Math.random() * 20)
                    });
                    fruitsCollection.add(fruit);
                    if (alphabets.hasOwnProperty(fruitName.substr(0, 1))) {
                        alphabets[fruitName.substr(0, 1)].get("fruits").add(fruit);
                    }
                });
            },
            initialize = function () {
                var FruitItem = Ribs.createMixed({
                       mixinClasses: [
                           Ribs.mixins.Templated({
                               templateFunction: _.template($("#fruit-item-tmpl").html()),
                               tagClass: "fruit-item"
                           }),
                           Ribs.mixins.Hoverable({}),
                           Ribs.mixins.Selectable({})
                       ]
                    }),
                    FruitDetails = Ribs.createMixed({
                        requireModel: false,
                        mixinClasses: [
                            Ribs.mixins.Templated({
                                templateFunction: _.template($("#fruit-details-tmpl").html())
                            })
                        ]
                    }),
                    PlainList = Ribs.createMixed({
                        mixinClasses: [
                            Ribs.mixins.Templated({
                               templateFunction: _.template($("#plain-list-tmpl").html())
                            }),
                            Ribs.mixins.SimpleList({
                                elementSelector: ".list",
                                ItemRenderer: FruitItem
                            })
                        ]
                    }),
                    AlphabetItem = Ribs.createMixed({
                        mixinClasses: [
                            Ribs.mixins.Templated({
                                templateFunction: _.template($("#alphabet-item-tmpl").html()),
                                tagClass: "alphabet-item"
                            }),
                            Ribs.mixins.ToggleableElement({ elementSelector: ".nested-fruit-list:first" }),
                            Ribs.mixins.SimpleList({
                                elementSelector: ".nested-fruit-list:first",
                                ItemRenderer: FruitItem,
                                listAttributeName: "fruits"
                            }),
                            Ribs.mixins.Hoverable({ elementSelector: ".item-body:first" }),
                            Ribs.mixins.Hoverable({ elementSelector: ".folder-icon:first" }),
                            Ribs.mixins.Toggleable({ elementSelector: ".item-body:first" }),
                            Ribs.mixins.Toggleable({ elementSelector: ".folder-icon:first", usePlusMinus: true })
                        ]
                    }),
                    AlphabetList = Ribs.createMixed({
                        mixinClasses: [
                            Ribs.mixins.Templated({
                                templateFunction: _.template($("#alphabet-list-tmpl").html())
                            }),
                            Ribs.mixins.SimpleList({
                                elementSelector: ".list",
                                ItemRenderer: AlphabetItem
                            })
                        ]
                    });

                Ribs.createUIManager("main", { allowMultiselect: false });
                Ribs.uiManagers.main.register(fruitsCollection);
                Ribs.uiManagers.main.register(alphabetsCollection);
                Ribs.uiManagers.main.getViewModel().bind("change:nowSelected", function (item) {
                    var nowSelected = item.get("nowSelected");
                    fruitDetailsView.bindToModel(nowSelected ? nowSelected.get("owner") : null);
                    fruitDetailsView.render();
                });


                fruitDetailsView = new FruitDetails({ el: $("#fruit-details") });
                new PlainList({ model: fruitsCollection, el: $("#fruit-list")});
                new AlphabetList({ model: alphabetsCollection, el: $("#alphabet-list")});
            };

            $.ajax({ url: "json/fruits.json", dataType: "text",
                    success: function (data) {
                        generateAlphabets();
                        generateFruits(data);
                        initialize();
                    }
            });

    </script>
</head>
<body>

<div id="alphabet-list"></div>
<div id="fruit-list"></div>
<div id="fruit-details"></div>

<script id="alphabet-list-tmpl" type="text/html">
<h2>alphabetical</h2>
<div class="list"></div>
</script>

<script id="plain-list-tmpl" type="text/html">
<h2>plain</h2>
<div class="list"></div>
</script>

<script id="fruit-item-tmpl" type="text/html">
<%= name %> (<%= available ? "available" : "sold out"%>)
</script>

<script id="fruit-details-tmpl" type="text/html">
<h1><%= name ? name : "No fruit selected" %></h1>
<p><%= t("available") %></p>
</script>

<script id="alphabet-item-tmpl" type="text/html">
<div><span class="folder-icon">+</span><div class="item-body"><b><%= alphabet %></b> (<%= fruits.length %> fruits)</div></div>
<div class="nested-fruit-list"></div>
</script>

</body>
</html>